

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Lectura 8-2: Transformaciones &#8212; MEL 202302</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Week_8/8-2-transformations';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lectura 8-3: Colinealidad" href="8-3-collinearity.html" />
    <link rel="prev" title="Lectura 8-1: Diagnóstico de modelos" href="8-1-diagnostics.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../Syllabus.html">
  
  
  
  
  
    <p class="title logo__title">MEL 202302</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../Syllabus.html">
                    Syllabus
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Semana 1</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Week_1/1-0-Schedule_week_1.html">Semana 1. Introducción al análisis estadístico</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Week_1/1-1-Introduction_pensamiento_stat.html">Lectura 1-1: Introducción al Pensamiento estadístico</a></li>




<li class="toctree-l1"><a class="reference internal" href="../Week_1/1-2-Estad%C3%ADstica_descriptiva.html">Lectura 1-2:  Estadística Descriptiva</a></li>








<li class="toctree-l1"><a class="reference internal" href="../Week_1/1-3-Visualizations.html">Lectura 1-3: Visualización de datos con Python</a></li>




</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Semana 2</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Week_2/2-0-Schedule_week_2.html">Semana 2. Probabilidad y distribuciones Probabilidad y Distribuciones</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Week_2/2-1-Prob.html">Lectura 2-1: Probabilidad y estadística</a></li>





</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Semana 3</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Week_3/3-1-Inference.html">Lectura 3-1: Inferencia estadística</a></li>

<li class="toctree-l1"><a class="reference internal" href="../Week_3/3-2-Hypothesis.html">Lectura 3-2: Pruebas de Hipotesis</a></li>







<li class="toctree-l1"><a class="reference internal" href="../Week_3/3-3-Hypothesis_2.html">Lectura 3-3: Pruebas de Hipotesis 2.</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Semana 4</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Week_4/4-1%20Correlaciones.html">Lectura 4-1: Correlaciones</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Week_4/4-2-Simple_linear_regression.html">Lectura 4-2: Regresión lineal simple</a></li>




<li class="toctree-l1"><a class="reference internal" href="../Week_4/4-3-SLR_supuestos.html">Lectura 4-3: Supuestos de la regresión lineal simple</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Semana 5</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Week_5/5-2-Hypothesis_Confidence.html">Lectura 5-1: Inferencia en RLS</a></li>









</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Semana 7</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Week_7/7-1-Multiple_linear_regresion.html">Lectura 7-1: Regresión Lineal Múltiple</a></li>




<li class="toctree-l1"><a class="reference internal" href="../Week_7/7-2-Categorical_variables.html">Lectura 7-2: Predictores categóricos e interacciones</a></li>





</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Semana 8</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="8-1-diagnostics.html">Lectura 8-1: Diagnóstico de modelos</a></li>




<li class="toctree-l1 current active"><a class="current reference internal" href="#">Lectura 8-2: Transformaciones</a></li>




<li class="toctree-l1"><a class="reference internal" href="8-3-collinearity.html">Lectura 8-3: Colinealidad</a></li>


</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/tabarespozos/MEL_202302/blob/MEL_202302/Week_8/8-2-transformations.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/tabarespozos/MEL_202302" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/tabarespozos/MEL_202302/issues/new?title=Issue%20on%20page%20%2FWeek_8/8-2-transformations.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Week_8/8-2-transformations.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lectura 8-2: Transformaciones</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Lectura 8-2: Transformaciones</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#transformacion-de-la-respuesta">Transformación de la respuesta</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#transformaciones-estabilizadoras-de-la-varianza">Transformaciones estabilizadoras de la varianza</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#transformaciones-de-box-cox">Transformaciones de Box-Cox</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#transformacion-del-predictor">Transformación del predictor</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#polinomios">Polinomios</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#transformaciones-de-respuesta">Transformaciones de respuesta</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#transformaciones-del-predictor">Transformaciones del predictor</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#un-modelo-cuadratico">Un modelo cuadrático</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="lectura-8-2-transformaciones">
<h1>Lectura 8-2: Transformaciones<a class="headerlink" href="#lectura-8-2-transformaciones" title="Permalink to this heading">#</a></h1>
<p>Anteriormente comprobamos los supuestos de los modelos de regresión y vimos formas de diagnosticar posibles problemas. En este capítulo utilizaremos transformaciones tanto de la respuesta como de las variables predictoras para corregir problemas con el diagnóstico de modelos, y también para hacer que un modelo se ajuste mejor a los datos.</p>
</section>
<section id="transformacion-de-la-respuesta">
<h1>Transformación de la respuesta<a class="headerlink" href="#transformacion-de-la-respuesta" title="Permalink to this heading">#</a></h1>
<p>Veamos algunos datos salariales (<em>ficticios</em>) de la empresa (<em>ficticia</em>) <em>Initech</em>. Intentaremos modelar el <code class="docutils literal notranslate"><span class="pre">salario</span></code> como una función de los <code class="docutils literal notranslate"><span class="pre">años</span></code> de experiencia. Los datos se encuentran en</p>
<p><span class="xref myst"><code class="docutils literal notranslate"><span class="pre">initech.csv</span></code></span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span>

<span class="c1"># Cargamos los datos</span>
<span class="n">initech</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/initech.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">initech</span><span class="p">[</span><span class="s1">&#39;years&#39;</span><span class="p">],</span> <span class="n">initech</span><span class="p">[</span><span class="s1">&#39;salary&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>  <span class="c1"># s parameter is used for size of points</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Salaries at Initech, By Seniority&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Years&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Salary&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6d3a8e70c1f48f9510ebb421fb2121a663b65bd71feb1b9953378e50634f1283.png" src="../_images/6d3a8e70c1f48f9510ebb421fb2121a663b65bd71feb1b9953378e50634f1283.png" />
</div>
</div>
<p>Primero ajustamos un modelo lineal simple.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">initech_fit</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="s1">&#39;salary ~ years&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">initech</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">initech_fit</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                 salary   R-squared:                       0.834
Model:                            OLS   Adj. R-squared:                  0.832
Method:                 Least Squares   F-statistic:                     492.8
Date:                Mon, 09 Oct 2023   Prob (F-statistic):           5.16e-40
Time:                        09:45:57   Log-Likelihood:                -1162.5
No. Observations:                 100   AIC:                             2329.
Df Residuals:                      98   BIC:                             2334.
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept   5302.0807   5749.963      0.922      0.359   -6108.534    1.67e+04
years       8636.6123    389.044     22.200      0.000    7864.567    9408.658
==============================================================================
Omnibus:                        1.672   Durbin-Watson:                   1.331
Prob(Omnibus):                  0.433   Jarque-Bera (JB):                1.129
Skew:                           0.212   Prob(JB):                        0.569
Kurtosis:                       3.303   Cond. No.                         31.2
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
<p>Este modelo parece significativo, pero ¿cumple los supuestos del modelo?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">initech</span><span class="p">[</span><span class="s1">&#39;years&#39;</span><span class="p">],</span> <span class="n">initech</span><span class="p">[</span><span class="s1">&#39;salary&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Salaries at Initech, By Seniority&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Years&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Salary&#39;</span><span class="p">)</span>

<span class="c1"># Plotting the regression line</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">initech</span><span class="p">[</span><span class="s1">&#39;years&#39;</span><span class="p">],</span> <span class="n">initech_fit</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/c2a41735767dc6cc6d6d3bb35ae9dc1e6795c9d0e34ff309cf9daa02f646a655.png" src="../_images/c2a41735767dc6cc6d6d3bb35ae9dc1e6795c9d0e34ff309cf9daa02f646a655.png" />
</div>
</div>
<p>Añadiendo la línea ajustada al gráfico, vemos que la relación lineal parece correcta.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="c1"># Fitted vs Residuals Plot</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">initech_fit</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">,</span> <span class="n">initech_fit</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Fitted versus Residuals&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Fitted&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Residuals&#39;</span><span class="p">)</span>

<span class="c1"># Q-Q Plot using scipy&#39;s probplot</span>
<span class="n">stats</span><span class="o">.</span><span class="n">probplot</span><span class="p">(</span><span class="n">initech_fit</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_lines</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_markerfacecolor</span><span class="p">(</span><span class="s1">&#39;darkgrey&#39;</span><span class="p">)</span>  <span class="c1"># Changing the color of the dots to &#39;darkgrey&#39;</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_lines</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">)</span>  <span class="c1"># Changing the color of the line to &#39;dodgerblue&#39;</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Normal Q-Q Plot&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Normal Q-Q Plot&#39;)
</pre></div>
</div>
<img alt="../_images/b753d96d98d82d059aeb39db0dfc4b093e5d295a0361f828cd4d0e20efdd784f.png" src="../_images/b753d96d98d82d059aeb39db0dfc4b093e5d295a0361f828cd4d0e20efdd784f.png" />
</div>
</div>
<p>Sin embargo, del gráfico de valores ajustados frente a residuos se desprende que la varianza no es constante. Específicamente, la varianza aumenta a medida que aumenta el valor ajustado.</p>
<section id="transformaciones-estabilizadoras-de-la-varianza">
<h2>Transformaciones estabilizadoras de la varianza<a class="headerlink" href="#transformaciones-estabilizadoras-de-la-varianza" title="Permalink to this heading">#</a></h2>
<p>Recordemos que el valor ajustado es nuestra estimación de la media en un valor particular de <span class="math notranslate nohighlight">\(x\)</span>. Bajo nuestros supuestos habituales,
$<span class="math notranslate nohighlight">\(
  \epsilon \sim N(0,\sigma^2)
\)</span><span class="math notranslate nohighlight">\(
y así
\)</span><span class="math notranslate nohighlight">\(
  \text{Var}[Y | X = x] = \sigma^2
\)</span><span class="math notranslate nohighlight">\(
que es un valor constante para cualquier valor de \)</span>x<span class="math notranslate nohighlight">\(.
Sin embargo, aquí vemos que la varianza es función de la media,
\)</span><span class="math notranslate nohighlight">\(
  \text{Var}[Y \mid X = x] = h(\text{E}[Y \mid X = x]).
\)</span><span class="math notranslate nohighlight">\(
En este caso, \)</span>h<span class="math notranslate nohighlight">\( es alguna función creciente.
Para corregir esto, nos gustaría encontrar alguna función de \)</span>Y<span class="math notranslate nohighlight">\(, \)</span>g(Y)<span class="math notranslate nohighlight">\( tal que,
\)</span><span class="math notranslate nohighlight">\(
  \text{Var}[g(Y) \mid X = x] = c
\)</span><span class="math notranslate nohighlight">\(
donde \)</span>c<span class="math notranslate nohighlight">\( es una constante que no depende de la media, \)</span>\text{E}[Y \mid X = x]<span class="math notranslate nohighlight">\(. Una transformación que logra esto se llama una **transformación estabilizadora de la varianza.**
Una transformación estabilizadora de la varianza (VST) común cuando vemos el aumento de la varianza en un gráfico de ajuste frente a los residuos es \)</span>log(Y)<span class="math notranslate nohighlight">\(. Además, si los valores de una variable varían en másde un orden de magnitud y la variable es *estrictamente positiva*, entonces sustituir la variable por su logaritmo es probable que sea útil.
Recordemos que, para nuestros propósitos, \)</span>\log<span class="math notranslate nohighlight">\( y \)</span>\ln<span class="math notranslate nohighlight">\( son el logaritmo natural. R&quot; utiliza &quot;log&quot; para referirse al logaritmo natural, a menos que se especifique una base diferente.
Ahora utilizaremos un modelo con una respuesta transformada logarítmicamente para los datos de *Initech*,
\)</span><span class="math notranslate nohighlight">\(
  \log(Y_i) = \beta_0 + \beta_1 x_i + \epsilon_i.
\)</span><span class="math notranslate nohighlight">\(
Obsérvese que si volvemos a escalar el modelo desde una escala logarítmica a la escala original de los datos, ahora tenemos
\)</span><span class="math notranslate nohighlight">\(
  Y_i = \exp(\beta_0 + \beta_1 x_i) \cdot \exp(\epsilon_i)
\)</span>$
que hace que los errores entren en el modelo de forma multiplicativa.</p>
<p>El ajuste de este modelo en <code class="docutils literal notranslate"><span class="pre">Python</span></code> sólo requiere una pequeña modificación de la especificación de nuestra fórmula.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">initech_fit_log</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="s1">&#39;np.log(salary) ~ years&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">initech</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Observe que aunque <code class="docutils literal notranslate"><span class="pre">log(y)</span></code> se considera la nueva variable de respuesta, en realidad no creamos una nueva variable en <code class="docutils literal notranslate"><span class="pre">Python</span></code>, sino que simplemente transformamos la variable dentro de la fórmula del modelo.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">initech</span><span class="p">[</span><span class="s1">&#39;years&#39;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">initech</span><span class="p">[</span><span class="s1">&#39;salary&#39;</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">initech</span><span class="p">[</span><span class="s1">&#39;years&#39;</span><span class="p">],</span> <span class="n">initech_fit_log</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Salaries at Initech, By Seniority&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Years&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Log(Salary)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/5f66dbbca77985a1e517b9bedd465a61381724cc0f3b21fed7cf691aa31966fc.png" src="../_images/5f66dbbca77985a1e517b9bedd465a61381724cc0f3b21fed7cf691aa31966fc.png" />
</div>
</div>
<p>Si trazamos los datos en la escala logarítmica transformada y añadimos la recta ajustada, la relación vuelve a parecer lineal, y ya podemos ver que la variación en torno a la recta ajustada parece constante.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">initech</span><span class="p">[</span><span class="s1">&#39;years&#39;</span><span class="p">],</span> <span class="n">initech</span><span class="p">[</span><span class="s1">&#39;salary&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Salaries at Initech, By Seniority&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Years&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Salary&#39;</span><span class="p">)</span>

<span class="c1"># Adding curve</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>  <span class="c1"># Assuming the years go from 0 to 30</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">initech_fit_log</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">initech_fit_log</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d569d885bfd4e0b3e22f5cfac0a11b099d0b0d24c5c94287939ed022a4807ed0.png" src="../_images/d569d885bfd4e0b3e22f5cfac0a11b099d0b0d24c5c94287939ed022a4807ed0.png" />
</div>
</div>
<p>Trazando los datos en la escala original, y añadiendo la regresión ajustada, vemos una relación exponencial. Sin embargo, esto sigue siendo un modelo <em>lineal</em>, ya que la nueva respuesta transformada, <span class="math notranslate nohighlight">\(\log(y)\)</span>, sigue siendo una combinación <em>lineal</em> de los predictores.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="c1"># Fitted vs Residuals Plot</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">initech_fit_log</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">,</span> <span class="n">initech_fit_log</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Fitted versus Residuals&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Fitted&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Residuals&#39;</span><span class="p">)</span>

<span class="c1"># Q-Q Plot using scipy&#39;s probplot</span>
<span class="n">stats</span><span class="o">.</span><span class="n">probplot</span><span class="p">(</span><span class="n">initech_fit_log</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_lines</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_markerfacecolor</span><span class="p">(</span><span class="s1">&#39;darkgrey&#39;</span><span class="p">)</span>  <span class="c1"># Changing the color of the dots to &#39;darkgrey&#39;</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_lines</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">)</span>  <span class="c1"># Changing the color of the line to &#39;dodgerblue&#39;</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Normal Q-Q Plot&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2771c4afef743bd7b71abc6c99074a8d06cc9cd6826e4535ba9e22f44a7c76d8.png" src="../_images/2771c4afef743bd7b71abc6c99074a8d06cc9cd6826e4535ba9e22f44a7c76d8.png" />
</div>
</div>
<p>El gráfico de ajuste frente a los residuos tiene mucho mejor aspecto. Parece que ya no se incumple el supuesto de varianza constante.</p>
<p>Comparando el RMSE utilizando la respuesta original y la transformada, también vemos que el modelo transformado logarítmicamente simplemente se ajusta mejor, con un error cuadrático medio menor.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rmse_original</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">initech_fit</span><span class="o">.</span><span class="n">resid</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="n">rmse_log_transformed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">initech_fit_log</span><span class="o">.</span><span class="n">resid</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>



<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE Original:&#39;</span><span class="p">,</span> <span class="n">rmse_original</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE Log Transformed:&#39;</span><span class="p">,</span> <span class="n">rmse_log_transformed</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE Original: 27080.161878492752
RMSE Log Transformed: 0.19349066503490941
</pre></div>
</div>
</div>
</div>
<p>Pero espera, eso no es justo, esta diferencia se debe simplemente a las diferentes escalas utilizadas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rmse_manual_original</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">initech</span><span class="p">[</span><span class="s1">&#39;salary&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">initech_fit</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">rmse_manual_log_transformed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">initech</span><span class="p">[</span><span class="s1">&#39;salary&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">initech_fit_log</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Manual RMSE Original:&#39;</span><span class="p">,</span> <span class="n">rmse_manual_original</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Manual RMSE Log Transformed:&#39;</span><span class="p">,</span> <span class="n">rmse_manual_log_transformed</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Manual RMSE Original: 27080.161878492752
Manual RMSE Log Transformed: 24280.36450564545
</pre></div>
</div>
</div>
</div>
<p>Si volvemos a transformar los valores ajustados del modelo logarítmico a la escala de los datos, vemos que se ajusta mejor.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">initech_fit_log</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:         np.log(salary)   R-squared:                       0.891
Model:                            OLS   Adj. R-squared:                  0.890
Method:                 Least Squares   F-statistic:                     805.2
Date:                Mon, 09 Oct 2023   Prob (F-statistic):           4.63e-49
Time:                        09:45:58   Log-Likelihood:                 22.359
No. Observations:                 100   AIC:                            -40.72
Df Residuals:                      98   BIC:                            -35.51
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept     10.4838      0.041    255.179      0.000      10.402      10.565
years          0.0789      0.003     28.376      0.000       0.073       0.084
==============================================================================
Omnibus:                        3.204   Durbin-Watson:                   1.818
Prob(Omnibus):                  0.202   Jarque-Bera (JB):                2.855
Skew:                          -0.413   Prob(JB):                        0.240
Kurtosis:                       3.049   Cond. No.                         31.2
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
<p>De nuevo, la respuesta transformada es una combinación <em>lineal</em> de los predictores,</p>
<div class="math notranslate nohighlight">
\[ \log(\hat{y}(x)) = \hat{\beta}_0 + \hat{\beta}_1 x  = 10.484 + 0.079x. \]</div>
<p>Pero ahora, si volvemos a escalar los datos desde una escala logarítmica a la escala original de los datos, ahora tenemos</p>
<div class="math notranslate nohighlight">
\[ \hat{y}(x) = \exp(\hat{\beta}_0) \exp(\hat{\beta}_1 x) = \exp(10.484)\exp(0.079x).\]</div>
<p>Vemos que por cada año adicional de experiencia, el salario medio aumenta <span class="math notranslate nohighlight">\(\exp(0.079) = 1.0822\)</span>  veces. Ahora estamos multiplicando, no sumando.</p>
<p>Aunque el uso de una transformación <span class="math notranslate nohighlight">\(\log\)</span> es posiblemente la transformación de variable de respuesta más común, existen muchas otras. Ahora consideraremos una familia de transformaciones y elegiremos la mejor de entre ellas, que incluye la transformación <span class="math notranslate nohighlight">\(\log\)</span>.</p>
</section>
<section id="transformaciones-de-box-cox">
<h2>Transformaciones de Box-Cox<a class="headerlink" href="#transformaciones-de-box-cox" title="Permalink to this heading">#</a></h2>
<p>El método de Box-Cox considera una familia de transformaciones sobre variables de respuesta estrictamente positivas,</p>
<div class="math notranslate nohighlight">
\[\begin{split}g_\lambda(y) = \left\{
\begin{array}{lr}\displaystyle\frac{y^\lambda - 1}{\lambda} &amp;  \lambda \neq 0\\
        &amp; \\
       \log(y) &amp;  \lambda = 0
     \end{array}
   \right. \end{split}\]</div>
<p>El parámetro <span class="math notranslate nohighlight">\(\lambda\)</span> se elige maximizando numéricamente la log-verosimilitud,</p>
<div class="math notranslate nohighlight">
\[L(\lambda) = -\frac{n}{2}\log(RSS_\lambda / n) + (\lambda -1)\sum \log(y_i).\]</div>
<p>A <span class="math notranslate nohighlight">\(100(1 - \alpha)\%\)</span> intervalo de confianza para <span class="math notranslate nohighlight">\(\lambda\)</span> es,</p>
<div class="math notranslate nohighlight">
\[ \left\{ \lambda :  L(\lambda) &gt; L(\hat{\lambda}) - \frac{1}{2}\chi_{1,\alpha}^2  \right\} \]</div>
<p>que <code class="docutils literal notranslate"><span class="pre">Python</span></code> trazará para nosotros para ayudarnos a seleccionar rápidamente un valor <span class="math notranslate nohighlight">\(\lambda\)</span> apropiado. A menudo elegimos un valor “bonito” dentro del intervalo de confianza, en lugar del valor de <span class="math notranslate nohighlight">\(\lambda\)</span> que realmente maximiza la probabilidad.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">faraway</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Defaulting to user installation because normal site-packages is not writeable
Collecting faraway
  Using cached faraway-0.0.6-py3-none-any.whl (224 kB)
Installing collected packages: faraway
Successfully installed faraway-0.0.6
Note: you may need to restart the kernel to use updated packages.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">faraway.utils</span>
<span class="kn">import</span> <span class="nn">faraway.datasets.savings</span>

<span class="n">savings</span> <span class="o">=</span> <span class="n">faraway</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">savings</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="n">savings</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sr</th>
      <th>pop15</th>
      <th>pop75</th>
      <th>dpi</th>
      <th>ddpi</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Australia</th>
      <td>11.43</td>
      <td>29.35</td>
      <td>2.87</td>
      <td>2329.68</td>
      <td>2.87</td>
    </tr>
    <tr>
      <th>Austria</th>
      <td>12.07</td>
      <td>23.32</td>
      <td>4.41</td>
      <td>1507.99</td>
      <td>3.93</td>
    </tr>
    <tr>
      <th>Belgium</th>
      <td>13.17</td>
      <td>23.80</td>
      <td>4.43</td>
      <td>2108.47</td>
      <td>3.82</td>
    </tr>
    <tr>
      <th>Bolivia</th>
      <td>5.75</td>
      <td>41.89</td>
      <td>1.67</td>
      <td>189.13</td>
      <td>0.22</td>
    </tr>
    <tr>
      <th>Brazil</th>
      <td>12.88</td>
      <td>42.19</td>
      <td>0.83</td>
      <td>728.47</td>
      <td>4.56</td>
    </tr>
    <tr>
      <th>Canada</th>
      <td>8.79</td>
      <td>31.72</td>
      <td>2.85</td>
      <td>2982.88</td>
      <td>2.43</td>
    </tr>
    <tr>
      <th>Chile</th>
      <td>0.60</td>
      <td>39.74</td>
      <td>1.34</td>
      <td>662.86</td>
      <td>2.67</td>
    </tr>
    <tr>
      <th>China</th>
      <td>11.90</td>
      <td>44.75</td>
      <td>0.67</td>
      <td>289.52</td>
      <td>6.51</td>
    </tr>
    <tr>
      <th>Colombia</th>
      <td>4.98</td>
      <td>46.64</td>
      <td>1.06</td>
      <td>276.65</td>
      <td>3.08</td>
    </tr>
    <tr>
      <th>Costa Rica</th>
      <td>10.78</td>
      <td>47.64</td>
      <td>1.14</td>
      <td>471.24</td>
      <td>2.80</td>
    </tr>
    <tr>
      <th>Denmark</th>
      <td>16.85</td>
      <td>24.42</td>
      <td>3.93</td>
      <td>2496.53</td>
      <td>3.99</td>
    </tr>
    <tr>
      <th>Ecuador</th>
      <td>3.59</td>
      <td>46.31</td>
      <td>1.19</td>
      <td>287.77</td>
      <td>2.19</td>
    </tr>
    <tr>
      <th>Finland</th>
      <td>11.24</td>
      <td>27.84</td>
      <td>2.37</td>
      <td>1681.25</td>
      <td>4.32</td>
    </tr>
    <tr>
      <th>France</th>
      <td>12.64</td>
      <td>25.06</td>
      <td>4.70</td>
      <td>2213.82</td>
      <td>4.52</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>12.55</td>
      <td>23.31</td>
      <td>3.35</td>
      <td>2457.12</td>
      <td>3.44</td>
    </tr>
    <tr>
      <th>Greece</th>
      <td>10.67</td>
      <td>25.62</td>
      <td>3.10</td>
      <td>870.85</td>
      <td>6.28</td>
    </tr>
    <tr>
      <th>Guatamala</th>
      <td>3.01</td>
      <td>46.05</td>
      <td>0.87</td>
      <td>289.71</td>
      <td>1.48</td>
    </tr>
    <tr>
      <th>Honduras</th>
      <td>7.70</td>
      <td>47.32</td>
      <td>0.58</td>
      <td>232.44</td>
      <td>3.19</td>
    </tr>
    <tr>
      <th>Iceland</th>
      <td>1.27</td>
      <td>34.03</td>
      <td>3.08</td>
      <td>1900.10</td>
      <td>1.12</td>
    </tr>
    <tr>
      <th>India</th>
      <td>9.00</td>
      <td>41.31</td>
      <td>0.96</td>
      <td>88.94</td>
      <td>1.54</td>
    </tr>
    <tr>
      <th>Ireland</th>
      <td>11.34</td>
      <td>31.16</td>
      <td>4.19</td>
      <td>1139.95</td>
      <td>2.99</td>
    </tr>
    <tr>
      <th>Italy</th>
      <td>14.28</td>
      <td>24.52</td>
      <td>3.48</td>
      <td>1390.00</td>
      <td>3.54</td>
    </tr>
    <tr>
      <th>Japan</th>
      <td>21.10</td>
      <td>27.01</td>
      <td>1.91</td>
      <td>1257.28</td>
      <td>8.21</td>
    </tr>
    <tr>
      <th>Korea</th>
      <td>3.98</td>
      <td>41.74</td>
      <td>0.91</td>
      <td>207.68</td>
      <td>5.81</td>
    </tr>
    <tr>
      <th>Luxembourg</th>
      <td>10.35</td>
      <td>21.80</td>
      <td>3.73</td>
      <td>2449.39</td>
      <td>1.57</td>
    </tr>
    <tr>
      <th>Malta</th>
      <td>15.48</td>
      <td>32.54</td>
      <td>2.47</td>
      <td>601.05</td>
      <td>8.12</td>
    </tr>
    <tr>
      <th>Norway</th>
      <td>10.25</td>
      <td>25.95</td>
      <td>3.67</td>
      <td>2231.03</td>
      <td>3.62</td>
    </tr>
    <tr>
      <th>Netherlands</th>
      <td>14.65</td>
      <td>24.71</td>
      <td>3.25</td>
      <td>1740.70</td>
      <td>7.66</td>
    </tr>
    <tr>
      <th>New Zealand</th>
      <td>10.67</td>
      <td>32.61</td>
      <td>3.17</td>
      <td>1487.52</td>
      <td>1.76</td>
    </tr>
    <tr>
      <th>Nicaragua</th>
      <td>7.30</td>
      <td>45.04</td>
      <td>1.21</td>
      <td>325.54</td>
      <td>2.48</td>
    </tr>
    <tr>
      <th>Panama</th>
      <td>4.44</td>
      <td>43.56</td>
      <td>1.20</td>
      <td>568.56</td>
      <td>3.61</td>
    </tr>
    <tr>
      <th>Paraguay</th>
      <td>2.02</td>
      <td>41.18</td>
      <td>1.05</td>
      <td>220.56</td>
      <td>1.03</td>
    </tr>
    <tr>
      <th>Peru</th>
      <td>12.70</td>
      <td>44.19</td>
      <td>1.28</td>
      <td>400.06</td>
      <td>0.67</td>
    </tr>
    <tr>
      <th>Philippines</th>
      <td>12.78</td>
      <td>46.26</td>
      <td>1.12</td>
      <td>152.01</td>
      <td>2.00</td>
    </tr>
    <tr>
      <th>Portugal</th>
      <td>12.49</td>
      <td>28.96</td>
      <td>2.85</td>
      <td>579.51</td>
      <td>7.48</td>
    </tr>
    <tr>
      <th>South Africa</th>
      <td>11.14</td>
      <td>31.94</td>
      <td>2.28</td>
      <td>651.11</td>
      <td>2.19</td>
    </tr>
    <tr>
      <th>South Rhodesia</th>
      <td>13.30</td>
      <td>31.92</td>
      <td>1.52</td>
      <td>250.96</td>
      <td>2.00</td>
    </tr>
    <tr>
      <th>Spain</th>
      <td>11.77</td>
      <td>27.74</td>
      <td>2.87</td>
      <td>768.79</td>
      <td>4.35</td>
    </tr>
    <tr>
      <th>Sweden</th>
      <td>6.86</td>
      <td>21.44</td>
      <td>4.54</td>
      <td>3299.49</td>
      <td>3.01</td>
    </tr>
    <tr>
      <th>Switzerland</th>
      <td>14.13</td>
      <td>23.49</td>
      <td>3.73</td>
      <td>2630.96</td>
      <td>2.70</td>
    </tr>
    <tr>
      <th>Turkey</th>
      <td>5.13</td>
      <td>43.42</td>
      <td>1.08</td>
      <td>389.66</td>
      <td>2.96</td>
    </tr>
    <tr>
      <th>Tunisia</th>
      <td>2.81</td>
      <td>46.12</td>
      <td>1.21</td>
      <td>249.87</td>
      <td>1.13</td>
    </tr>
    <tr>
      <th>United Kingdom</th>
      <td>7.81</td>
      <td>23.27</td>
      <td>4.46</td>
      <td>1813.93</td>
      <td>2.01</td>
    </tr>
    <tr>
      <th>United States</th>
      <td>7.56</td>
      <td>29.81</td>
      <td>3.43</td>
      <td>4001.89</td>
      <td>2.45</td>
    </tr>
    <tr>
      <th>Venezuela</th>
      <td>9.22</td>
      <td>46.40</td>
      <td>0.90</td>
      <td>813.39</td>
      <td>0.53</td>
    </tr>
    <tr>
      <th>Zambia</th>
      <td>18.56</td>
      <td>45.25</td>
      <td>0.56</td>
      <td>138.33</td>
      <td>5.14</td>
    </tr>
    <tr>
      <th>Jamaica</th>
      <td>7.72</td>
      <td>41.12</td>
      <td>1.73</td>
      <td>380.47</td>
      <td>10.23</td>
    </tr>
    <tr>
      <th>Uruguay</th>
      <td>9.24</td>
      <td>28.13</td>
      <td>2.72</td>
      <td>766.54</td>
      <td>1.88</td>
    </tr>
    <tr>
      <th>Libya</th>
      <td>8.89</td>
      <td>43.69</td>
      <td>2.07</td>
      <td>123.58</td>
      <td>16.71</td>
    </tr>
    <tr>
      <th>Malaysia</th>
      <td>4.71</td>
      <td>47.20</td>
      <td>0.66</td>
      <td>242.69</td>
      <td>5.08</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Aquí necesitamos el paquete <code class="docutils literal notranslate"><span class="pre">MASS</span></code> para la función <code class="docutils literal notranslate"><span class="pre">boxcox()</span></code>, y consideraremos un par de conjuntos de datos del paquete <code class="docutils literal notranslate"><span class="pre">faraway</span></code>.</p>
<p>Primero utilizaremos el conjunto de datos <code class="docutils literal notranslate"><span class="pre">savings</span></code> como ejemplo del uso del método Box-Cox para justificar el uso de ninguna transformación. Ajustamos un modelo de regresión múltiple aditiva con <code class="docutils literal notranslate"><span class="pre">sr</span></code> como respuesta y cada una de las demás variables como predictores.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Assuming savings is already a DataFrame containing your data</span>
<span class="n">dependent_var</span> <span class="o">=</span> <span class="s1">&#39;sr&#39;</span>
<span class="n">independent_vars</span> <span class="o">=</span> <span class="n">savings</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">independent_vars</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">dependent_var</span><span class="p">)</span>  <span class="c1"># remove the dependent variable from the list</span>
<span class="n">formula</span> <span class="o">=</span> <span class="n">dependent_var</span> <span class="o">+</span> <span class="s1">&#39; ~ &#39;</span> <span class="o">+</span> <span class="s1">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">independent_vars</span><span class="p">)</span>

<span class="n">savings_model</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">savings</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>A continuación, utilizamos la función <code class="docutils literal notranslate"><span class="pre">boxcox()</span></code> para encontrar la mejor transformación de la forma considerada por el método de Box Cox.</p>
<p><code class="docutils literal notranslate"><span class="pre">Python</span></code> traza automáticamente la log-verosimilitud en función de los posibles valores de <span class="math notranslate nohighlight">\(\lambda\)</span>. Indica tanto el valor que maximiza la log-verosimilitud como un intervalo de confianza para el valor <span class="math notranslate nohighlight">\(\lambda\)</span> que maximiza la log-verosimilitud.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Shift residuals to be positive</span>
<span class="n">shifted_resid</span> <span class="o">=</span> <span class="n">savings_model</span><span class="o">.</span><span class="n">resid</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">savings_model</span><span class="o">.</span><span class="n">resid</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># shift to make all values positive</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">prob</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">boxcox_normplot</span><span class="p">(</span><span class="n">shifted_resid</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">_</span><span class="p">,</span> <span class="n">maxlog</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">boxcox</span><span class="p">(</span><span class="n">shifted_resid</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">maxlog</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/4663f3fffe4da9b54d8d68c38606a3776575d64ca2a7ad95368796d921bc46fb.png" src="../_images/4663f3fffe4da9b54d8d68c38606a3776575d64ca2a7ad95368796d921bc46fb.png" />
</div>
</div>
<p>Tenga en cuenta que podemos especificar un rango de <span class="math notranslate nohighlight">\(\lambda\)</span> valores a considerar y por lo tanto ser trazado. A menudo especificamos un rango que es visualmente más interesante. Aquí vemos que <span class="math notranslate nohighlight">\(\lambda = 1\)</span> es a la vez en el intervalo de confianza, y es muy cerca del máximo. Esto sugiere una transformación de la forma</p>
<div class="math notranslate nohighlight">
\[\frac{y^\lambda - 1}{\lambda} = \frac{y^1 - 1}{1} = y - 1.\]</div>
<p>En esencia, no se trata de una transformación. No cambiaría la varianza ni haría que el modelo se ajustara mejor. Restando 1 a cada valor, sólo cambiaríamos el intercepto del modelo, y los errores resultantes serían los mismos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fitted vs Residuals Plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">savings_model</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">,</span> <span class="n">savings_model</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Fitted&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residuals&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3a7c8c594b05eb1146990a9ad6513fc3073e04bb606ed58d7a4f51872ac44432.png" src="../_images/3a7c8c594b05eb1146990a9ad6513fc3073e04bb606ed58d7a4f51872ac44432.png" />
</div>
</div>
<p>Si se compara el ajuste con los residuos, se comprueba que no hay ningún problema con los supuestos de este modelo, como demuestran las pruebas de Breusch-Pagan y Shapiro-Wilk.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.compat</span> <span class="kn">import</span> <span class="n">lzip</span>
<span class="kn">import</span> <span class="nn">statsmodels.stats.api</span> <span class="k">as</span> <span class="nn">sms</span>

<span class="c1"># Breusch-Pagan Test</span>
<span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Lagrange multiplier statistic&#39;</span><span class="p">,</span> <span class="s1">&#39;p-value&#39;</span><span class="p">,</span> <span class="s1">&#39;f-value&#39;</span><span class="p">,</span> <span class="s1">&#39;f p-value&#39;</span><span class="p">]</span>
<span class="n">bp_test</span> <span class="o">=</span> <span class="n">sms</span><span class="o">.</span><span class="n">het_breuschpagan</span><span class="p">(</span><span class="n">savings_model</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">savings_model</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">exog</span><span class="p">)</span>
<span class="n">lzip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">bp_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;Lagrange multiplier statistic&#39;, 4.985161299125018),
 (&#39;p-value&#39;, 0.2888234302832432),
 (&#39;f-value&#39;, 1.2458794973770801),
 (&#39;f p-value&#39;, 0.3052588476653877)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Shapiro-Wilk Test for Normality</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">shapiro</span><span class="p">(</span><span class="n">savings_model</span><span class="o">.</span><span class="n">resid</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ShapiroResult(statistic=0.9869844317436218, pvalue=0.8523984551429749)
</pre></div>
</div>
</div>
</div>
<p>Ahora utilizaremos el conjunto de datos <code class="docutils literal notranslate"><span class="pre">gala</span></code> como ejemplo de utilización del método Box-Cox para justificar una transformación distinta de <span class="math notranslate nohighlight">\(\log\)</span>. Ajustamos un modelo de regresión múltiple aditiva con <code class="docutils literal notranslate"><span class="pre">Species</span></code> como respuesta y la mayoría de las demás variables como predictores.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">faraway.datasets.galapagos</span>

<span class="n">gala</span> <span class="o">=</span> <span class="n">faraway</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">galapagos</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="n">gala</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Species</th>
      <th>Area</th>
      <th>Elevation</th>
      <th>Nearest</th>
      <th>Scruz</th>
      <th>Adjacent</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Baltra</th>
      <td>58</td>
      <td>25.09</td>
      <td>346</td>
      <td>0.6</td>
      <td>0.6</td>
      <td>1.84</td>
    </tr>
    <tr>
      <th>Bartolome</th>
      <td>31</td>
      <td>1.24</td>
      <td>109</td>
      <td>0.6</td>
      <td>26.3</td>
      <td>572.33</td>
    </tr>
    <tr>
      <th>Caldwell</th>
      <td>3</td>
      <td>0.21</td>
      <td>114</td>
      <td>2.8</td>
      <td>58.7</td>
      <td>0.78</td>
    </tr>
    <tr>
      <th>Champion</th>
      <td>25</td>
      <td>0.10</td>
      <td>46</td>
      <td>1.9</td>
      <td>47.4</td>
      <td>0.18</td>
    </tr>
    <tr>
      <th>Coamano</th>
      <td>2</td>
      <td>0.05</td>
      <td>77</td>
      <td>1.9</td>
      <td>1.9</td>
      <td>903.82</td>
    </tr>
    <tr>
      <th>Daphne.Major</th>
      <td>18</td>
      <td>0.34</td>
      <td>119</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>1.84</td>
    </tr>
    <tr>
      <th>Daphne.Minor</th>
      <td>24</td>
      <td>0.08</td>
      <td>93</td>
      <td>6.0</td>
      <td>12.0</td>
      <td>0.34</td>
    </tr>
    <tr>
      <th>Darwin</th>
      <td>10</td>
      <td>2.33</td>
      <td>168</td>
      <td>34.1</td>
      <td>290.2</td>
      <td>2.85</td>
    </tr>
    <tr>
      <th>Eden</th>
      <td>8</td>
      <td>0.03</td>
      <td>71</td>
      <td>0.4</td>
      <td>0.4</td>
      <td>17.95</td>
    </tr>
    <tr>
      <th>Enderby</th>
      <td>2</td>
      <td>0.18</td>
      <td>112</td>
      <td>2.6</td>
      <td>50.2</td>
      <td>0.10</td>
    </tr>
    <tr>
      <th>Espanola</th>
      <td>97</td>
      <td>58.27</td>
      <td>198</td>
      <td>1.1</td>
      <td>88.3</td>
      <td>0.57</td>
    </tr>
    <tr>
      <th>Fernandina</th>
      <td>93</td>
      <td>634.49</td>
      <td>1494</td>
      <td>4.3</td>
      <td>95.3</td>
      <td>4669.32</td>
    </tr>
    <tr>
      <th>Gardner1</th>
      <td>58</td>
      <td>0.57</td>
      <td>49</td>
      <td>1.1</td>
      <td>93.1</td>
      <td>58.27</td>
    </tr>
    <tr>
      <th>Gardner2</th>
      <td>5</td>
      <td>0.78</td>
      <td>227</td>
      <td>4.6</td>
      <td>62.2</td>
      <td>0.21</td>
    </tr>
    <tr>
      <th>Genovesa</th>
      <td>40</td>
      <td>17.35</td>
      <td>76</td>
      <td>47.4</td>
      <td>92.2</td>
      <td>129.49</td>
    </tr>
    <tr>
      <th>Isabela</th>
      <td>347</td>
      <td>4669.32</td>
      <td>1707</td>
      <td>0.7</td>
      <td>28.1</td>
      <td>634.49</td>
    </tr>
    <tr>
      <th>Marchena</th>
      <td>51</td>
      <td>129.49</td>
      <td>343</td>
      <td>29.1</td>
      <td>85.9</td>
      <td>59.56</td>
    </tr>
    <tr>
      <th>Onslow</th>
      <td>2</td>
      <td>0.01</td>
      <td>25</td>
      <td>3.3</td>
      <td>45.9</td>
      <td>0.10</td>
    </tr>
    <tr>
      <th>Pinta</th>
      <td>104</td>
      <td>59.56</td>
      <td>777</td>
      <td>29.1</td>
      <td>119.6</td>
      <td>129.49</td>
    </tr>
    <tr>
      <th>Pinzon</th>
      <td>108</td>
      <td>17.95</td>
      <td>458</td>
      <td>10.7</td>
      <td>10.7</td>
      <td>0.03</td>
    </tr>
    <tr>
      <th>Las.Plazas</th>
      <td>12</td>
      <td>0.23</td>
      <td>94</td>
      <td>0.5</td>
      <td>0.6</td>
      <td>25.09</td>
    </tr>
    <tr>
      <th>Rabida</th>
      <td>70</td>
      <td>4.89</td>
      <td>367</td>
      <td>4.4</td>
      <td>24.4</td>
      <td>572.33</td>
    </tr>
    <tr>
      <th>SanCristobal</th>
      <td>280</td>
      <td>551.62</td>
      <td>716</td>
      <td>45.2</td>
      <td>66.6</td>
      <td>0.57</td>
    </tr>
    <tr>
      <th>SanSalvador</th>
      <td>237</td>
      <td>572.33</td>
      <td>906</td>
      <td>0.2</td>
      <td>19.8</td>
      <td>4.89</td>
    </tr>
    <tr>
      <th>SantaCruz</th>
      <td>444</td>
      <td>903.82</td>
      <td>864</td>
      <td>0.6</td>
      <td>0.0</td>
      <td>0.52</td>
    </tr>
    <tr>
      <th>SantaFe</th>
      <td>62</td>
      <td>24.08</td>
      <td>259</td>
      <td>16.5</td>
      <td>16.5</td>
      <td>0.52</td>
    </tr>
    <tr>
      <th>SantaMaria</th>
      <td>285</td>
      <td>170.92</td>
      <td>640</td>
      <td>2.6</td>
      <td>49.2</td>
      <td>0.10</td>
    </tr>
    <tr>
      <th>Seymour</th>
      <td>44</td>
      <td>1.84</td>
      <td>147</td>
      <td>0.6</td>
      <td>9.6</td>
      <td>25.09</td>
    </tr>
    <tr>
      <th>Tortuga</th>
      <td>16</td>
      <td>1.24</td>
      <td>186</td>
      <td>6.8</td>
      <td>50.9</td>
      <td>17.95</td>
    </tr>
    <tr>
      <th>Wolf</th>
      <td>21</td>
      <td>2.85</td>
      <td>253</td>
      <td>34.1</td>
      <td>254.7</td>
      <td>2.33</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Model for gala</span>
<span class="n">gala_model</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="s1">&#39;Species ~ Area + Elevation + Nearest + Scruz + Adjacent&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">gala</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fitted vs Residuals Plot for gala_model</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">gala_model</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">,</span> <span class="n">gala_model</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Fitted&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residuals&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/26a020ac769d7f507be95c38e53dd30967951d62d9a2f87ad3dfa66593a050f3.png" src="../_images/26a020ac769d7f507be95c38e53dd30967951d62d9a2f87ad3dfa66593a050f3.png" />
</div>
</div>
<p>Aunque no hay muchos datos para valores ajustados grandes, sigue pareciendo muy claro que se viola la hipótesis de varianza constante.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Shift residuals to be positive</span>
<span class="n">shifted_resid</span> <span class="o">=</span> <span class="n">gala_model</span><span class="o">.</span><span class="n">resid</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">gala_model</span><span class="o">.</span><span class="n">resid</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># shift to make all values positive</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">prob</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">boxcox_normplot</span><span class="p">(</span><span class="n">shifted_resid</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">_</span><span class="p">,</span> <span class="n">maxlog</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">boxcox</span><span class="p">(</span><span class="n">shifted_resid</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">maxlog</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/81f8da99bba18049b29d0a433a0db983a0d54226e17b46050a142f8570c17edd.png" src="../_images/81f8da99bba18049b29d0a433a0db983a0d54226e17b46050a142f8570c17edd.png" />
</div>
</div>
<p>Utilizando el método de Box-Cox, vemos que <span class="math notranslate nohighlight">\(\lambda = 0,3\)</span> está tanto en el intervalo de confianza, como extremadamente cerca del máximo, lo que sugiere una transformación de la forma</p>
<div class="math notranslate nohighlight">
\[ = . \]</div>
<p>A continuación, ajustamos un modelo con esta transformación aplicada a la respuesta.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add a new transformed variable to the DataFrame</span>
<span class="n">gala</span><span class="p">[</span><span class="s1">&#39;transformed_species&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">gala</span><span class="p">[</span><span class="s1">&#39;Species&#39;</span><span class="p">],</span> <span class="mf">0.3</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Now, use this new variable in the formula</span>
<span class="n">gala_model_cox</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="s1">&#39;transformed_species ~ Area + Elevation + Nearest + Scruz + Adjacent&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">gala</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fitted vs Residuals Plot for gala_model_cox</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">gala_model_cox</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">,</span> <span class="n">gala_model_cox</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Fitted&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residuals&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/cd72d7304e61bf7ce74c4b1215a1adbb393b6a4d5530705fb09280c20abf1b87.png" src="../_images/cd72d7304e61bf7ce74c4b1215a1adbb393b6a4d5530705fb09280c20abf1b87.png" />
</div>
</div>
<p>El gráfico resultante del ajuste frente a los residuos tiene mucho mejor aspecto.</p>
<p>Por último, volvemos a los datos <code class="docutils literal notranslate"><span class="pre">initech</span></code> y al modelo <code class="docutils literal notranslate"><span class="pre">initech_fit</span></code> que habíamos utilizado antes. Recordemos que este fue el modelo sin transformar, que hemos utilizado un <span class="math notranslate nohighlight">\(\log\)</span> transformar a arreglar.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Shift residuals to be positive</span>
<span class="n">shifted_resid</span> <span class="o">=</span> <span class="n">initech_fit</span><span class="o">.</span><span class="n">resid</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">initech_fit</span><span class="o">.</span><span class="n">resid</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># shift to make all values positive</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">prob</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">boxcox_normplot</span><span class="p">(</span><span class="n">shifted_resid</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">_</span><span class="p">,</span> <span class="n">maxlog</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">boxcox</span><span class="p">(</span><span class="n">shifted_resid</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">maxlog</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/a1ede489012cc28312674ab075416b18b1a896e27ade30dee8d73b5a82871801.png" src="../_images/a1ede489012cc28312674ab075416b18b1a896e27ade30dee8d73b5a82871801.png" />
</div>
</div>
<p>Usando el método Box-Cox, vemos que <span class="math notranslate nohighlight">\(\lambda = 0\)</span> está en el intervalo, y extremadamente cerca del máximo, lo que sugiere una transformación de la forma</p>
<div class="math notranslate nohighlight">
\[ (y). \]</div>
<p>¡Así que el método Box-Cox justifica nuestra elección anterior de una transformación <span class="math notranslate nohighlight">\(\log\)</span>!</p>
</section>
</section>
<section id="transformacion-del-predictor">
<h1>Transformación del predictor<a class="headerlink" href="#transformacion-del-predictor" title="Permalink to this heading">#</a></h1>
<p>Además de la transformación de la variable de respuesta, también podemos considerar transformaciones de las variables predictoras. A veces estas transformaciones pueden ayudar con la violación de los supuestos del modelo, y otras veces se pueden utilizar simplemente para ajustar un modelo más flexible.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read data frame from the web</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://archive.ics.uci.edu/ml/machine-learning-databases/auto-mpg/auto-mpg.data&quot;</span>
<span class="n">autompg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;\s+&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">quotechar</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;?&quot;</span><span class="p">])</span>

<span class="c1"># Assign headers to the dataframe</span>
<span class="n">autompg</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mpg&quot;</span><span class="p">,</span> <span class="s2">&quot;cyl&quot;</span><span class="p">,</span> <span class="s2">&quot;disp&quot;</span><span class="p">,</span> <span class="s2">&quot;hp&quot;</span><span class="p">,</span> <span class="s2">&quot;wt&quot;</span><span class="p">,</span> <span class="s2">&quot;acc&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;origin&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]</span>

<span class="c1"># Remove rows with missing &#39;hp&#39; data</span>
<span class="n">autompg</span> <span class="o">=</span> <span class="n">autompg</span><span class="p">[</span><span class="n">autompg</span><span class="p">[</span><span class="s1">&#39;hp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()]</span>

<span class="c1"># Remove &#39;plymouth reliant&#39;</span>
<span class="n">autompg</span> <span class="o">=</span> <span class="n">autompg</span><span class="p">[</span><span class="n">autompg</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;plymouth reliant&quot;</span><span class="p">]</span>

<span class="c1"># Create row names based on the engine, year, and name</span>
<span class="n">autompg</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">autompg</span><span class="p">[</span><span class="s1">&#39;cyl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; cylinder &quot;</span> <span class="o">+</span> <span class="n">autompg</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">autompg</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>

<span class="c1"># Drop the &#39;name&#39; column</span>
<span class="n">autompg</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Convert horsepower from object to numeric</span>
<span class="n">autompg</span><span class="p">[</span><span class="s1">&#39;hp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">autompg</span><span class="p">[</span><span class="s1">&#39;hp&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Create a dummy variable for foreign vs. domestic cars. Domestic = 1.</span>
<span class="n">autompg</span><span class="p">[</span><span class="s1">&#39;domestic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">autompg</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># Remove 3 and 5 cylinder cars</span>
<span class="n">autompg</span> <span class="o">=</span> <span class="n">autompg</span><span class="p">[</span><span class="o">~</span><span class="n">autompg</span><span class="p">[</span><span class="s1">&#39;cyl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">])]</span>

<span class="c1"># Change &#39;cyl&#39; to a category variable</span>
<span class="n">autompg</span><span class="p">[</span><span class="s1">&#39;cyl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">autompg</span><span class="p">[</span><span class="s1">&#39;cyl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>

<span class="c1"># Display the structure (similar to str in R)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">autompg</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Index: 383 entries, 8 cylinder 70 chevrolet chevelle malibu to 4 cylinder 82 chevy s-10
Data columns (total 9 columns):
 #   Column    Non-Null Count  Dtype   
---  ------    --------------  -----   
 0   mpg       383 non-null    float64 
 1   cyl       383 non-null    category
 2   disp      383 non-null    float64 
 3   hp        383 non-null    float64 
 4   wt        383 non-null    float64 
 5   acc       383 non-null    float64 
 6   year      383 non-null    int64   
 7   origin    383 non-null    int64   
 8   domestic  383 non-null    int32   
dtypes: category(1), float64(5), int32(1), int64(2)
memory usage: 25.9+ KB
None
</pre></div>
</div>
</div>
</div>
<p>Recordemos el conjunto de datos <code class="docutils literal notranslate"><span class="pre">autompg</span></code> del capítulo anterior. Aquí intentaremos modelar las <code class="docutils literal notranslate"><span class="pre">mpg</span></code> en función de los <code class="docutils literal notranslate"><span class="pre">hp</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load &#39;autompg&#39; dataset</span>
<span class="c1"># autompg = pd.read_csv(&#39;path_to_autompg.csv&#39;)  # adjust path to your actual path to &#39;autompg.csv&#39;</span>

<span class="c1"># Assuming &#39;autompg&#39; DataFrame is loaded and available</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>

<span class="c1"># First Row Plots</span>
<span class="n">mpg_hp</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="s1">&#39;mpg ~ hp&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">autompg</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">autompg</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;hp&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;mpg&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">autompg</span><span class="p">[</span><span class="s1">&#39;hp&#39;</span><span class="p">],</span> <span class="n">mpg_hp</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mpg_hp</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">,</span> <span class="n">mpg_hp</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">)</span>

<span class="c1"># Second Row Plots</span>
<span class="n">mpg_hp_log</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="s1">&#39;np.log(mpg) ~ hp&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">autompg</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">autompg</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;hp&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;mpg&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">,</span> <span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">autompg</span><span class="p">[</span><span class="s1">&#39;hp&#39;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">mpg_hp_log</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mpg_hp_log</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">,</span> <span class="n">mpg_hp_log</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">)</span>

<span class="c1"># Third Row Plots</span>
<span class="n">mpg_hp_loglog</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="s1">&#39;np.log(mpg) ~ np.log(hp)&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">autompg</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">autompg</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;hp&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;mpg&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">,</span> <span class="n">loglog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">autompg</span><span class="p">[</span><span class="s1">&#39;hp&#39;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">mpg_hp_loglog</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mpg_hp_loglog</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">,</span> <span class="n">mpg_hp_loglog</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">)</span>

<span class="c1"># Adjust labels</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;hp&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;mpg&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Fitted&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Residuals&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/09f5f928d078ce3835f93040b23fdb1cdfe909bb9db40a89d8716c405226273c.png" src="../_images/09f5f928d078ce3835f93040b23fdb1cdfe909bb9db40a89d8716c405226273c.png" />
</div>
</div>
<p>Primero intentamos SLR, pero vemos un patrón bastante obvio en el gráfico de ajuste frente a residuos, que incluye el aumento de la varianza, por lo que intentamos una transformación <span class="math notranslate nohighlight">\(\log\)</span> de la respuesta.</p>
<p>Después de realizar la transformada <span class="math notranslate nohighlight">\(\log\)</span> de la respuesta, todavía tenemos algunos de los mismos problemas con el ajuste frente a la respuesta. Ahora, vamos a tratar también <span class="math notranslate nohighlight">\(\log\)</span> transformar el <strong>predictor</strong>.</p>
<p>Finalmenete, nuestro gráfico de ajuste versus residuales se ve bien luego de transformación.</p>
<section id="polinomios">
<h2>Polinomios<a class="headerlink" href="#polinomios" title="Permalink to this heading">#</a></h2>
<p>Otra “transformación” muy común de una variable predictora es el uso de transformaciones polinómicas. Son extremadamente útiles ya que permiten modelos más flexibles, pero no cambian las unidades de las variables.</p>
<p>No debería sorprendernos que las ventas de un producto estén relacionadas con el  el presupuesto publicitario del mismo, pero hay rendimientos decrecientes. Una empresa no siempre puede esperar rendimientos lineales a partir de un aumento del presupuesto publicitario.</p>
<p>Consideremos los datos mensuales de las ventas de widgets de <em>Initech</em>, <span class="math notranslate nohighlight">\(y\)</span>, en función del gasto en publicidad de <em>Initech</em> para dicho widget, <span class="math notranslate nohighlight">\(x\)</span>, ambos en diez mil dólares. Los datos se encuentran en
<span class="xref myst"><code class="docutils literal notranslate"><span class="pre">marketing.csv</span></code></span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the marketing dataset</span>

<span class="n">marketing</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/marketing.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot sales vs advert</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">marketing</span><span class="p">[</span><span class="s1">&#39;advert&#39;</span><span class="p">],</span> <span class="n">marketing</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Advert Spending (in $10,000)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Sales (in $10,000)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/b289b84798a296769bd342020db51d17776866fccc6d4dc1c6419ca1062add0e.png" src="../_images/b289b84798a296769bd342020db51d17776866fccc6d4dc1c6419ca1062add0e.png" />
</div>
</div>
<p>Nos gustaría ajustar el modelo,</p>
<div class="math notranslate nohighlight">
\[ Y_i = \beta_0 + \beta_1 x_i + \beta_2 x_i^2 + \epsilon_i \]</div>
<p>where <span class="math notranslate nohighlight">\(\epsilon_i \sim N(0,\sigma^2)\)</span> para <span class="math notranslate nohighlight">\(i = 1, 2, \cdots 21.\)</span></p>
<p>La respuesta <span class="math notranslate nohighlight">\(y\)</span> es ahora una función <strong>lineal</strong> de “dos” variables, lo que permite que <span class="math notranslate nohighlight">\(y\)</span> sea una función no lineal del predictor único original <span class="math notranslate nohighlight">\(x\)</span>. Consideramos que se trata de una transformación, aunque en realidad, en cierto sentido, hemos añadido otro predictor.</p>
<p>Así, nuestra matriz <span class="math notranslate nohighlight">\(X\)</span> es</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{bmatrix}
  1      &amp; x_1 &amp; x_1^2    \\[3pt]
  1      &amp; x_2  &amp; x_2^2   \\[3pt]
  1      &amp; x_3  &amp; x_3^2   \\[3pt]
  \vdots &amp; \vdots &amp; \vdots \\[3pt]
  1      &amp; x_{n}  &amp; x_{n}^2   \\
  \end{bmatrix}
\end{split}\]</div>
<p>A continuación, podemos proceder a ajustar el modelo como hemos hecho en el pasado para la regresión lineal múltiple.</p>
<div class="math notranslate nohighlight">
\[ \hat{\beta} = \left(  X^\top X  \right)^{-1}X^\top y.\]</div>
<p>Nuestras estimaciones tendrán las propiedades habituales. La media sigue siendo</p>
<div class="math notranslate nohighlight">
\[E[\hat{\beta}] = \beta,\]</div>
<p>y la varianza</p>
<div class="math notranslate nohighlight">
\[\text{Var}[\hat{\beta}] = \sigma^2 \left(  X^\top X  \right)^{-1}. \]</div>
<p>También mantenemos los mismos resultados distributivos</p>
<div class="math notranslate nohighlight">
\[\hat{\beta}_j \sim N\left(\beta_j, \sigma^2 C_{jj}  \right).\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Linear Model: sales ~ advert</span>
<span class="n">mark_mod</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="s1">&#39;sales ~ advert&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">marketing</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mark_mod</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                  sales   R-squared:                       0.895
Model:                            OLS   Adj. R-squared:                  0.889
Method:                 Least Squares   F-statistic:                     161.8
Date:                Mon, 09 Oct 2023   Prob (F-statistic):           9.65e-11
Time:                        09:49:52   Log-Likelihood:                -42.304
No. Observations:                  21   AIC:                             88.61
Df Residuals:                      19   BIC:                             90.70
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept      9.4502      0.681     13.885      0.000       8.026      10.875
advert         1.1918      0.094     12.718      0.000       0.996       1.388
==============================================================================
Omnibus:                        3.151   Durbin-Watson:                   0.561
Prob(Omnibus):                  0.207   Jarque-Bera (JB):                1.295
Skew:                           0.091   Prob(JB):                        0.523
Kurtosis:                       1.797   Cond. No.                         12.0
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
<p>Aunque el modelo SLR es significativo, el gráfico de ajuste frente a los residuos tendría un patrón muy claro.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Polynomial Model of Degree 2: sales ~ advert + advert^2</span>
<span class="n">mark_mod_poly2</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="s1">&#39;sales ~ advert + I(advert ** 2)&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">marketing</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mark_mod_poly2</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                  sales   R-squared:                       0.959
Model:                            OLS   Adj. R-squared:                  0.954
Method:                 Least Squares   F-statistic:                     209.0
Date:                Mon, 09 Oct 2023   Prob (F-statistic):           3.49e-13
Time:                        09:49:52   Log-Likelihood:                -32.492
No. Observations:                  21   AIC:                             70.98
Df Residuals:                      18   BIC:                             74.12
Df Model:                           2                                         
Covariance Type:            nonrobust                                         
==================================================================================
                     coef    std err          t      P&gt;|t|      [0.025      0.975]
----------------------------------------------------------------------------------
Intercept          6.7616      0.672     10.059      0.000       5.349       8.174
advert             2.4623      0.248      9.917      0.000       1.941       2.984
I(advert ** 2)    -0.0875      0.017     -5.275      0.000      -0.122      -0.053
==============================================================================
Omnibus:                        1.370   Durbin-Watson:                   0.932
Prob(Omnibus):                  0.504   Jarque-Bera (JB):                0.956
Skew:                           0.202   Prob(JB):                        0.620
Kurtosis:                       2.036   Cond. No.                         225.
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
<p>Para añadir el término de segundo orden necesitamos utilizar la función <code class="docutils literal notranslate"><span class="pre">I()</span></code> en la especificación del modelo alrededor de nuestro predictor recién creado. Vemos que con el término de primer orden en el modelo, el término cuadrático también es significativo.</p>
<p>Aquí comprobamos que las estimaciones de los parámetros eran las esperadas.</p>
<p>También podríamos añadir términos de orden superior, como un predictor de tercer grado. Esto es fácil de hacer. Nuestra matriz <span class="math notranslate nohighlight">\(X\)</span> simplemente se hace más grande de nuevo.</p>
<div class="math notranslate nohighlight">
\[ Y_i = \beta_0 + \beta_1 x_i + \beta_2 x_i^2 + \beta_3 x_i^3 + \epsilon_i\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{bmatrix}
  1      &amp; x_1 &amp; x_1^2  &amp; x_1^3    \\[3pt]
  1      &amp; x_2  &amp; x_2^2  &amp; x_2^3   \\[3pt]
  1      &amp; x_3  &amp; x_3^2  &amp; x_3^3   \\[3pt]
  \vdots &amp; \vdots &amp; \vdots &amp; \vdots \\[3pt]
  1      &amp; x_{n}  &amp; x_{n}^2  &amp; x_{n}^3    \\
  \end{bmatrix}
\end{split}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Polynomial Model of Degree 3: sales ~ advert + advert^2 + advert^3</span>
<span class="n">mark_mod_poly3</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="s1">&#39;sales ~ advert + I(advert ** 2) + I(advert ** 3)&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">marketing</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mark_mod_poly3</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                  sales   R-squared:                       0.982
Model:                            OLS   Adj. R-squared:                  0.979
Method:                 Least Squares   F-statistic:                     310.2
Date:                Mon, 09 Oct 2023   Prob (F-statistic):           4.89e-15
Time:                        09:49:52   Log-Likelihood:                -23.739
No. Observations:                  21   AIC:                             55.48
Df Residuals:                      17   BIC:                             59.66
Df Model:                           3                                         
Covariance Type:            nonrobust                                         
==================================================================================
                     coef    std err          t      P&gt;|t|      [0.025      0.975]
----------------------------------------------------------------------------------
Intercept          3.8901      0.762      5.105      0.000       2.282       5.498
advert             4.6819      0.501      9.344      0.000       3.625       5.739
I(advert ** 2)    -0.4552      0.079     -5.763      0.000      -0.622      -0.289
I(advert ** 3)     0.0161      0.003      4.704      0.000       0.009       0.023
==============================================================================
Omnibus:                        1.635   Durbin-Watson:                   1.870
Prob(Omnibus):                  0.441   Jarque-Bera (JB):                1.102
Skew:                          -0.273   Prob(JB):                        0.576
Kurtosis:                       2.019   Cond. No.                     5.50e+03
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 5.5e+03. This might indicate that there are
strong multicollinearity or other numerical problems.
</pre></div>
</div>
</div>
</div>
<p>Ahora vemos que con los términos de primer y segundo orden en el modelo, el término de tercer orden también es significativo. Pero, ¿tiene esto sentido en la práctica? El siguiente gráfico nos da una pista de por qué no lo tiene. (El modelo con el término de tercer orden no tiene rendimientos decrecientes).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Polynomial Model Visualization</span>
<span class="n">xplot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">marketing</span><span class="p">[</span><span class="s1">&#39;advert&#39;</span><span class="p">],</span> <span class="n">marketing</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xplot</span><span class="p">,</span> <span class="n">mark_mod</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;advert&#39;</span><span class="p">:</span> <span class="n">xplot</span><span class="p">})),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xplot</span><span class="p">,</span> <span class="n">mark_mod_poly2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;advert&#39;</span><span class="p">:</span> <span class="n">xplot</span><span class="p">})),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xplot</span><span class="p">,</span> <span class="n">mark_mod_poly3</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;advert&#39;</span><span class="p">:</span> <span class="n">xplot</span><span class="p">})),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Advert Spending (in $10,000)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Sales (in $10,000)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/98bef8e1b13105e445c446906e9d782d184125629e6de14e90f0ebb61f986b22.png" src="../_images/98bef8e1b13105e445c446906e9d782d184125629e6de14e90f0ebb61f986b22.png" />
</div>
</div>
<p>Nótese que podríamos ajustar un polinomio de orden arbitrario,</p>
<div class="math notranslate nohighlight">
\[Y_i = \beta_0 + \beta_1 x_i + \beta_2 x_i^2 + \cdots + \beta_{p-1}x_i^{p-1} + \epsilon_i\]</div>
<p>Sin embargo, hay que tener cuidado con el sobreajuste, ya que con un polinomio de grado uno menos que el número de observaciones, a veces es posible ajustar perfectamente un modelo.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a new dataset with some randomness</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fit</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="s1">&#39;y ~ x + I(x ** 2)&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">y</span><span class="p">}))</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Polynomial Model of High Degree</span>
<span class="n">fit_perf</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="s1">&#39;y ~ x + I(x ** 2) + I(x ** 3) + I(x ** 4) + I(x ** 5) + I(x ** 6) + I(x ** 7) + I(x ** 8) + I(x ** 9) + I(x ** 10)&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">y</span><span class="p">}))</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fit_perf</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       1.000
Model:                            OLS   Adj. R-squared:                   -inf
Method:                 Least Squares   F-statistic:                       nan
Date:                Mon, 09 Oct 2023   Prob (F-statistic):                nan
Time:                        09:49:52   Log-Likelihood:                 87.385
No. Observations:                  11   AIC:                            -152.8
Df Residuals:                       0   BIC:                            -148.4
Df Model:                          10                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept     12.4286        inf          0        nan         nan         nan
x           -382.6242        inf         -0        nan         nan         nan
I(x ** 2)    666.5016        inf          0        nan         nan         nan
I(x ** 3)   -428.2440        inf         -0        nan         nan         nan
I(x ** 4)    140.3504        inf          0        nan         nan         nan
I(x ** 5)    -27.9717        inf         -0        nan         nan         nan
I(x ** 6)      4.2756        inf          0        nan         nan         nan
I(x ** 7)     -0.5974        inf         -0        nan         nan         nan
I(x ** 8)      0.0656        inf          0        nan         nan         nan
I(x ** 9)     -0.0042        inf         -0        nan         nan         nan
I(x ** 10)     0.0001        inf          0        nan         nan         nan
==============================================================================
Omnibus:                       18.929   Durbin-Watson:                   0.904
Prob(Omnibus):                  0.000   Jarque-Bera (JB):               13.182
Skew:                          -1.916   Prob(JB):                      0.00137
Kurtosis:                       6.752   Cond. No.                     4.46e+12
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 4.46e+12. This might indicate that there are
strong multicollinearity or other numerical problems.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c:\ProgramData\Anaconda3\lib\site-packages\scipy\stats\_stats_py.py:1769: UserWarning: kurtosistest only valid for n&gt;=20 ... continuing anyway, n=11
  warnings.warn(&quot;kurtosistest only valid for n&gt;=20 ... continuing &quot;
c:\ProgramData\Anaconda3\lib\site-packages\statsmodels\regression\linear_model.py:1749: RuntimeWarning: divide by zero encountered in true_divide
  return 1 - (np.divide(self.nobs - self.k_constant, self.df_resid)
c:\ProgramData\Anaconda3\lib\site-packages\statsmodels\regression\linear_model.py:1671: RuntimeWarning: divide by zero encountered in double_scalars
  return np.dot(wresid, wresid) / self.df_resid
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualizing Polynomial Model</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
<span class="n">xplot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xplot</span><span class="p">,</span> <span class="n">fit</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">xplot</span><span class="p">})),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xplot</span><span class="p">,</span> <span class="n">fit_perf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">xplot</span><span class="p">})),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/09b053384bbaed90ad46362bf1cf751f023b80cfb0d49d8b447beba4ccebac34.png" src="../_images/09b053384bbaed90ad46362bf1cf751f023b80cfb0d49d8b447beba4ccebac34.png" />
</div>
</div>
<p>Observe que en el resumen, <code class="docutils literal notranslate"><span class="pre">Python</span></code> no pudo calcular los errores estándar. Este es el resultado de estar “fuera” de los grados de libertad. Con 11 parámetros <span class="math notranslate nohighlight">\(\beta\)</span> y 11 puntos de datos, usamos todos los grados de libertad antes de que podamos estimar <span class="math notranslate nohighlight">\(\sigma\)</span>.</p>
<p>En este ejemplo, la verdadera relación es cuadrática, pero el ajuste del polinomio de orden 10 es “perfecto”. En la prõxima lectura nos centraremos en el equilibrio entre la bondad del ajuste (minimización de errores) y la complejidad del modelo.</p>
<p>Supongamos que trabaja para un fabricante de automóviles que fabrica una gran berlina de lujo. Le gustaría saber cómo se comporta el carro desde el punto de vista de la eficiencia del combustible cuando se conduce a distintas velocidades. En lugar de probar el carro a todas las velocidades imaginables (lo que sería imposible), se crea un experimento en el que el carro se conduce a las velocidades de interés en incrementos de 5 millas por hora.</p>
<p>Nuestro objetivo, entonces, es ajustar un modelo a estos datos para poder predecir la eficiencia del combustible cuando se conduce a ciertas velocidades. Los datos de este ejemplo se pueden encontrar en <span class="xref myst"><code class="docutils literal notranslate"><span class="pre">fuel_econ.csv</span></code></span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">econ</span>  <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/fuel_econ.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>En este ejemplo, miraremos con frecuencia el gráfico de ajuste frente a los residuos, por lo que <em>deberíamos</em> escribir una función que nos facilite la vida, observela abajo, creo que es una buena manera de prácticar los conocimientos adquiridos en las aulas de fundamentos de programación.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_econ_curve</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">econ</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">econ</span><span class="o">.</span><span class="n">mph</span><span class="p">,</span> <span class="n">econ</span><span class="o">.</span><span class="n">mpg</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Speed (Miles per Hour)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Fuel Efficiency (Miles per Gallon)&quot;</span><span class="p">)</span>
    <span class="n">xplot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">75.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xplot</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;mph&#39;</span><span class="p">:</span> <span class="n">xplot</span><span class="p">})),</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Así que primero ajustamos una regresión lineal simple a estos datos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fit the Models</span>
<span class="n">fit1</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="s1">&#39;mpg ~ mph&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">econ</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">plot_econ_curve</span><span class="p">(</span><span class="n">fit1</span><span class="p">,</span> <span class="n">econ</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8c875a38cda3faa6ae14439007e449ed3c184f8b3e1a087d16448d5b47ab90d5.png" src="../_images/8c875a38cda3faa6ae14439007e449ed3c184f8b3e1a087d16448d5b47ab90d5.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot the residuals</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">fit1</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">,</span> <span class="n">fit1</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Fitted Values&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Residuals&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/613c122671672ac988a433aa9e54dbc61dd8c4bab0aba9d80962a363be3687cd.png" src="../_images/613c122671672ac988a433aa9e54dbc61dd8c4bab0aba9d80962a363be3687cd.png" />
</div>
</div>
<p>Está claro que podemos hacerlo mejor. Sí, la eficiencia del combustible aumenta al aumentar la velocidad, pero sólo hasta cierto punto.</p>
<p>Ahora añadiremos términos polinómicos hasta que consigamos un ajuste adecuado.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Second model</span>
<span class="n">fit2</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="s1">&#39;mpg ~ mph + I(mph ** 2)&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">econ</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fit2</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
<span class="n">plot_econ_curve</span><span class="p">(</span><span class="n">fit2</span><span class="p">,</span> <span class="n">econ</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                    mpg   R-squared:                       0.919
Model:                            OLS   Adj. R-squared:                  0.912
Method:                 Least Squares   F-statistic:                     141.5
Date:                Mon, 09 Oct 2023   Prob (F-statistic):           2.34e-14
Time:                        09:49:53   Log-Likelihood:                -52.392
No. Observations:                  28   AIC:                             110.8
Df Residuals:                      25   BIC:                             114.8
Df Model:                           2                                         
Covariance Type:            nonrobust                                         
===============================================================================
                  coef    std err          t      P&gt;|t|      [0.025      0.975]
-------------------------------------------------------------------------------
Intercept       2.4445      1.424      1.716      0.098      -0.489       5.377
mph             1.2717      0.076     16.792      0.000       1.116       1.428
I(mph ** 2)    -0.0145      0.001    -16.633      0.000      -0.016      -0.013
==============================================================================
Omnibus:                        0.340   Durbin-Watson:                   0.950
Prob(Omnibus):                  0.844   Jarque-Bera (JB):                0.501
Skew:                           0.018   Prob(JB):                        0.779
Kurtosis:                       2.346   Cond. No.                     1.28e+04
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 1.28e+04. This might indicate that there are
strong multicollinearity or other numerical problems.
</pre></div>
</div>
<img alt="../_images/a873820571c979aef9aea956c650f195684a8431adea6a1136e3cef61b48efae.png" src="../_images/a873820571c979aef9aea956c650f195684a8431adea6a1136e3cef61b48efae.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#plot the residuals</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">fit2</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">,</span> <span class="n">fit2</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Fitted Values&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Residuals&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/50ecdc9fd6b1e88f32a53ded2330a5b0945818dab2f4126db3f167ec7f7ba559.png" src="../_images/50ecdc9fd6b1e88f32a53ded2330a5b0945818dab2f4126db3f167ec7f7ba559.png" />
</div>
</div>
<p>Aunque este modelo se ajusta mucho mejor y el término de segundo orden es significativo, seguimos viendo un patrón en el gráfico de ajuste frente a los residuos que sugiere que los términos de orden superior ayudarán. Además, cabría esperar que la curva se aplanara a medida que aumenta o disminuye la velocidad, y no que descendiera bruscamente como vemos aquí.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fit3</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="s1">&#39;mpg ~ mph + I(mph ** 2) + I(mph ** 3)&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">econ</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fit3</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
<span class="n">plot_econ_curve</span><span class="p">(</span><span class="n">fit3</span><span class="p">,</span> <span class="n">econ</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                    mpg   R-squared:                       0.919
Model:                            OLS   Adj. R-squared:                  0.909
Method:                 Least Squares   F-statistic:                     90.56
Date:                Mon, 09 Oct 2023   Prob (F-statistic):           3.17e-13
Time:                        09:49:53   Log-Likelihood:                -52.388
No. Observations:                  28   AIC:                             112.8
Df Residuals:                      24   BIC:                             118.1
Df Model:                           3                                         
Covariance Type:            nonrobust                                         
===============================================================================
                  coef    std err          t      P&gt;|t|      [0.025      0.975]
-------------------------------------------------------------------------------
Intercept       2.2578      2.768      0.816      0.423      -3.455       7.971
mph             1.2908      0.253      5.103      0.000       0.769       1.813
I(mph ** 2)    -0.0150      0.007     -2.274      0.032      -0.029      -0.001
I(mph ** 3)  4.066e-06   5.13e-05      0.079      0.938      -0.000       0.000
==============================================================================
Omnibus:                        0.366   Durbin-Watson:                   0.949
Prob(Omnibus):                  0.833   Jarque-Bera (JB):                0.516
Skew:                           0.015   Prob(JB):                        0.773
Kurtosis:                       2.336   Cond. No.                     1.60e+06
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 1.6e+06. This might indicate that there are
strong multicollinearity or other numerical problems.
</pre></div>
</div>
<img alt="../_images/d4c5c8418140399d281626aa6e9dde728bc011d8ed0f5adc075556056d72be02.png" src="../_images/d4c5c8418140399d281626aa6e9dde728bc011d8ed0f5adc075556056d72be02.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#plot the residuals</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">fit3</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">,</span> <span class="n">fit3</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Fitted Values&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Residuals&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/eb1183f4fc5668f6acd204c9ed734a8aef6910f749d4b47c57996bf31d284779.png" src="../_images/eb1183f4fc5668f6acd204c9ed734a8aef6910f749d4b47c57996bf31d284779.png" />
</div>
</div>
<p>Añadir el término de tercer orden no parece ayudar en absoluto. La curva ajustada apenas cambia. Esto tiene sentido, ya que lo que queremos es que la curva se aplane en los extremos. Para ello necesitaremos un término polinómico de grado par.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fit4</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="s1">&#39;mpg ~ mph + I(mph ** 2) + I(mph ** 3) + I(mph ** 4)&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">econ</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fit4</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
<span class="n">plot_econ_curve</span><span class="p">(</span><span class="n">fit4</span><span class="p">,</span> <span class="n">econ</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                    mpg   R-squared:                       0.977
Model:                            OLS   Adj. R-squared:                  0.973
Method:                 Least Squares   F-statistic:                     240.2
Date:                Mon, 09 Oct 2023   Prob (F-statistic):           2.14e-18
Time:                        09:49:53   Log-Likelihood:                -34.965
No. Observations:                  28   AIC:                             79.93
Df Residuals:                      23   BIC:                             86.59
Df Model:                           4                                         
Covariance Type:            nonrobust                                         
===============================================================================
                  coef    std err          t      P&gt;|t|      [0.025      0.975]
-------------------------------------------------------------------------------
Intercept      21.4605      2.965      7.238      0.000      15.327      27.594
mph            -1.4677      0.391     -3.751      0.001      -2.277      -0.658
I(mph ** 2)     0.1081      0.017      6.463      0.000       0.074       0.143
I(mph ** 3)    -0.0021      0.000     -7.488      0.000      -0.003      -0.002
I(mph ** 4)  1.255e-05   1.66e-06      7.539      0.000    9.11e-06     1.6e-05
==============================================================================
Omnibus:                        0.140   Durbin-Watson:                   2.019
Prob(Omnibus):                  0.933   Jarque-Bera (JB):                0.299
Skew:                           0.138   Prob(JB):                        0.861
Kurtosis:                       2.576   Cond. No.                     2.14e+08
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 2.14e+08. This might indicate that there are
strong multicollinearity or other numerical problems.
</pre></div>
</div>
<img alt="../_images/fe2c11944b0ff02c59821a7384ef179d2c0ebd36753f27914a5f8fb878bbbbf1.png" src="../_images/fe2c11944b0ff02c59821a7384ef179d2c0ebd36753f27914a5f8fb878bbbbf1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#plot the residuals</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">fit4</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">,</span> <span class="n">fit4</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Fitted Values&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Residuals&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/a82e786b33746f15662e442b113a8df15f28e297d511c80952c47d2ce0c80e75.png" src="../_images/a82e786b33746f15662e442b113a8df15f28e297d511c80952c47d2ce0c80e75.png" />
</div>
</div>
<p>Ahora estamos progresando. El término de cuarto orden es significativo con los demás términos del modelo. También empezamos a ver lo que esperábamos para velocidades bajas y altas. Sin embargo, parece que sigue habiendo un cierto patrón en los residuos, así que volveremos a probar con más términos de orden superior. Añadiremos el quinto y el sexto juntos, ya que añadir el quinto será similar a añadir el tercero.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fit6</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="s1">&#39;mpg ~ mph + I(mph ** 2) + I(mph ** 3) + I(mph ** 4) + I(mph ** 5) + I(mph ** 6)&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">econ</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fit6</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
<span class="n">plot_econ_curve</span><span class="p">(</span><span class="n">fit6</span><span class="p">,</span> <span class="n">econ</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                    mpg   R-squared:                       0.982
Model:                            OLS   Adj. R-squared:                  0.976
Method:                 Least Squares   F-statistic:                     186.0
Date:                Mon, 09 Oct 2023   Prob (F-statistic):           4.37e-17
Time:                        09:49:53   Log-Likelihood:                -31.665
No. Observations:                  28   AIC:                             77.33
Df Residuals:                      21   BIC:                             86.66
Df Model:                           6                                         
Covariance Type:            nonrobust                                         
===============================================================================
                  coef    std err          t      P&gt;|t|      [0.025      0.975]
-------------------------------------------------------------------------------
Intercept      -4.2063     12.043     -0.349      0.730     -29.252      20.839
mph             4.2034      2.553      1.646      0.115      -1.106       9.513
I(mph ** 2)    -0.3521      0.201     -1.750      0.095      -0.771       0.066
I(mph ** 3)     0.0158      0.008      2.053      0.053      -0.000       0.032
I(mph ** 4)    -0.0003      0.000     -2.271      0.034      -0.001   -2.93e-05
I(mph ** 5)  3.585e-06   1.52e-06      2.362      0.028    4.29e-07    6.74e-06
I(mph ** 6) -1.402e-08   5.94e-09     -2.360      0.028   -2.64e-08   -1.67e-09
==============================================================================
Omnibus:                        1.752   Durbin-Watson:                   2.344
Prob(Omnibus):                  0.416   Jarque-Bera (JB):                1.300
Skew:                           0.307   Prob(JB):                        0.522
Kurtosis:                       2.142   Cond. No.                     4.69e+12
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 4.69e+12. This might indicate that there are
strong multicollinearity or other numerical problems.
</pre></div>
</div>
<img alt="../_images/2ddc4ad25935f3e7ce53d0a6393e09a2156702d5f4ffbe9e1279ee74b2516aa1.png" src="../_images/2ddc4ad25935f3e7ce53d0a6393e09a2156702d5f4ffbe9e1279ee74b2516aa1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#plot the residuals</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">fit6</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">,</span> <span class="n">fit6</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Fitted Values&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Residuals&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/c62afcdb41855b9b3380ef1ee0daa956777efb833b61761fc7e8dabdee9e5161.png" src="../_images/c62afcdb41855b9b3380ef1ee0daa956777efb833b61761fc7e8dabdee9e5161.png" />
</div>
</div>
<p>De nuevo, el término de sexto orden es significativo con los demás términos del modelo y aquí vemos menos patrón en el gráfico de residuos. Probemos ahora cuál de los dos modelos anteriores preferimos. Probaremos</p>
<div class="math notranslate nohighlight">
\[H_0: \beta_5 = \beta_6 = 0.\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ANOVA between fit4 and fit6</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sm</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">anova_lm</span><span class="p">(</span><span class="n">fit4</span><span class="p">,</span> <span class="n">fit6</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   df_resid        ssr  df_diff   ss_diff         F    Pr(&gt;F)
0      23.0  19.921504      0.0       NaN       NaN       NaN
1      21.0  15.738708      2.0  4.182796  2.790531  0.084196
</pre></div>
</div>
</div>
</div>
<p>Así pues, esta prueba no rechaza la hipótesis nula a un nivel de significación de <span class="math notranslate nohighlight">\(\alpha = 0,05\)</span>, sin embargo el valor p sigue siendo bastante pequeño, y el gráfico de ajuste frente a residuos es mucho mejor para el modelo con el término de sexto orden. Esto hace que el modelo de sexto orden sea una buena elección. Podemos repetir este proceso una vez más.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fit8</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="s1">&#39;mpg ~ mph + I(mph ** 2) + I(mph ** 3) + I(mph ** 4) + I(mph ** 5) + I(mph ** 6) + I(mph ** 7) + I(mph ** 8)&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">econ</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fit8</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
<span class="n">plot_econ_curve</span><span class="p">(</span><span class="n">fit8</span><span class="p">,</span> <span class="n">econ</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                    mpg   R-squared:                       0.978
Model:                            OLS   Adj. R-squared:                  0.972
Method:                 Least Squares   F-statistic:                     157.5
Date:                Mon, 09 Oct 2023   Prob (F-statistic):           2.40e-16
Time:                        09:49:54   Log-Likelihood:                -33.947
No. Observations:                  28   AIC:                             81.89
Df Residuals:                      21   BIC:                             91.22
Df Model:                           6                                         
Covariance Type:            nonrobust                                         
===============================================================================
                  coef    std err          t      P&gt;|t|      [0.025      0.975]
-------------------------------------------------------------------------------
Intercept       0.0145      0.001     13.302      0.000       0.012       0.017
mph             0.1031      0.008     13.319      0.000       0.087       0.119
I(mph ** 2)     0.4498      0.034     13.373      0.000       0.380       0.520
I(mph ** 3)    -0.0518      0.005     -9.423      0.000      -0.063      -0.040
I(mph ** 4)     0.0027      0.000      7.668      0.000       0.002       0.003
I(mph ** 5) -7.226e-05    1.1e-05     -6.577      0.000   -9.51e-05   -4.94e-05
I(mph ** 6)  1.079e-06   1.87e-07      5.780      0.000    6.91e-07    1.47e-06
I(mph ** 7) -8.371e-09   1.62e-09     -5.160      0.000   -1.17e-08      -5e-09
I(mph ** 8)  2.642e-11   5.67e-12      4.664      0.000    1.46e-11    3.82e-11
==============================================================================
Omnibus:                        0.913   Durbin-Watson:                   1.959
Prob(Omnibus):                  0.634   Jarque-Bera (JB):                0.888
Skew:                           0.252   Prob(JB):                        0.641
Kurtosis:                       2.288   Cond. No.                     1.41e+17
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 1.41e+17. This might indicate that there are
strong multicollinearity or other numerical problems.
</pre></div>
</div>
<img alt="../_images/f8764cfe0f55d5daa1f6b136e73599520a1bd1936ea622829f6252de6b56dbe4.png" src="../_images/f8764cfe0f55d5daa1f6b136e73599520a1bd1936ea622829f6252de6b56dbe4.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#plot the residuals</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">fit8</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">,</span> <span class="n">fit8</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Fitted Values&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Residuals&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/57ee65322042731580948045f6535626d20e17e913d547988f93d0d02dde150f.png" src="../_images/57ee65322042731580948045f6535626d20e17e913d547988f93d0d02dde150f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">sm</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">anova_lm</span><span class="p">(</span><span class="n">fit6</span><span class="p">,</span> <span class="n">fit8</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   df_resid        ssr  df_diff   ss_diff    F  Pr(&gt;F)
0      21.0  15.738708      0.0       NaN  NaN     NaN
1      21.0  18.524790     -0.0 -2.786082  inf     NaN
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">{r,</span> <span class="pre">fig.height</span> <span class="pre">=</span> <span class="pre">4,</span> <span class="pre">fig.width</span> <span class="pre">=</span> <span class="pre">8}</span> <span class="pre">par(mfrow</span> <span class="pre">=</span> <span class="pre">c(1,</span> <span class="pre">2))</span> <span class="pre">plot_econ_curve(fit8)</span> <span class="pre">plot(fitted(fit8),</span> <span class="pre">resid(fit8),</span> <span class="pre">xlab</span> <span class="pre">=</span> <span class="pre">&quot;Fitted&quot;,</span> <span class="pre">ylab</span> <span class="pre">=</span> <span class="pre">&quot;Residuals&quot;,</span>&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">col</span> <span class="pre">=</span> <span class="pre">&quot;dodgerblue&quot;,</span> <span class="pre">pch</span> <span class="pre">=</span> <span class="pre">20,</span> <span class="pre">cex</span> <span class="pre">=</span> <span class="pre">2)</span>&#160;&#160; <span class="pre">abline(h</span> <span class="pre">=</span> <span class="pre">0,</span> <span class="pre">col</span> <span class="pre">=</span> <span class="pre">&quot;darkorange&quot;,</span> <span class="pre">lwd</span> <span class="pre">=</span> <span class="pre">2)</span></code></p>
<p>Aquí nos quedaríamos claramente con <code class="docutils literal notranslate"><span class="pre">fit6</span></code>. El término de octavo orden no es significativo con los demás términos del modelo y la prueba F no rechaza.</p>
<p>Ya hemos visto cómo transformar las variables predictoras y de respuesta. En esta lectura nos hemos centrado principalmente en su uso en el contexto de la fijación de modelos SLR. Sin embargo, estos conceptos pueden utilizarse fácilmente junto con variables categóricas e interacciones para construir modelos más amplios y flexibles. En el próximo capítulo, analizaremos cómo elegir un buen modelo entre una colección de modelos posibles.</p>
</section>
</section>
<section id="transformaciones-de-respuesta">
<h1>Transformaciones de respuesta<a class="headerlink" href="#transformaciones-de-respuesta" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the salary vs years</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">initech</span><span class="o">.</span><span class="n">years</span><span class="p">,</span> <span class="n">initech</span><span class="o">.</span><span class="n">salary</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Salaries at Initech, By Seniority&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Years&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Salary&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/19e6398edb41f3695dfa5ea9fa140499d7d31437c5da0c0a448827990a73fc71.png" src="../_images/19e6398edb41f3695dfa5ea9fa140499d7d31437c5da0c0a448827990a73fc71.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fit the linear model</span>
<span class="n">initech_fit</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="s1">&#39;salary ~ years&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">initech</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">initech_fit</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                 salary   R-squared:                       0.834
Model:                            OLS   Adj. R-squared:                  0.832
Method:                 Least Squares   F-statistic:                     492.8
Date:                Mon, 09 Oct 2023   Prob (F-statistic):           5.16e-40
Time:                        09:49:54   Log-Likelihood:                -1162.5
No. Observations:                 100   AIC:                             2329.
Df Residuals:                      98   BIC:                             2334.
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept   5302.0807   5749.963      0.922      0.359   -6108.534    1.67e+04
years       8636.6123    389.044     22.200      0.000    7864.567    9408.658
==============================================================================
Omnibus:                        1.672   Durbin-Watson:                   1.331
Prob(Omnibus):                  0.433   Jarque-Bera (JB):                1.129
Skew:                           0.212   Prob(JB):                        0.569
Kurtosis:                       3.303   Cond. No.                         31.2
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting with regression line</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">initech</span><span class="o">.</span><span class="n">years</span><span class="p">,</span> <span class="n">initech</span><span class="o">.</span><span class="n">salary</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">initech</span><span class="o">.</span><span class="n">years</span><span class="p">,</span> <span class="n">initech_fit</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Salaries at Initech, By Seniority&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Years&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Salary&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/87da3d0cc9df9f935b688271e1863fa9f6c83cf24dda5f3dac2b585c582d0e62.png" src="../_images/87da3d0cc9df9f935b688271e1863fa9f6c83cf24dda5f3dac2b585c582d0e62.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">probplot</span>
<span class="c1"># Plotting residuals</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">initech_fit</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">,</span> <span class="n">initech_fit</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Fitted vs Residuals&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Fitted&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Residuals&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">probplot</span><span class="p">(</span><span class="n">initech_fit</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">plt</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Normal Q-Q Plot&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6d99eea8a4f166d0521bedd82ac68f991de723825a87487de801b9ff23b81146.png" src="../_images/6d99eea8a4f166d0521bedd82ac68f991de723825a87487de801b9ff23b81146.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Log Transformation</span>
<span class="n">initech_fit_log</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="s1">&#39;np.log(salary) ~ years&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">initech</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting log transformation</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">initech</span><span class="o">.</span><span class="n">years</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">initech</span><span class="o">.</span><span class="n">salary</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">initech</span><span class="o">.</span><span class="n">years</span><span class="p">,</span> <span class="n">initech_fit_log</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Salaries at Initech, By Seniority&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Years&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;log(Salary)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d21a43d7c908fe718699e26e04b7572fd5e9fe17902f6f20b142c1324c677f2d.png" src="../_images/d21a43d7c908fe718699e26e04b7572fd5e9fe17902f6f20b142c1324c677f2d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting Exponential of Fitted values</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">initech</span><span class="o">.</span><span class="n">years</span><span class="p">,</span> <span class="n">initech</span><span class="o">.</span><span class="n">salary</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">initech</span><span class="o">.</span><span class="n">years</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">initech_fit_log</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Salaries at Initech, By Seniority&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Years&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Salary&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3bcc2dcf792af3a459d9571adbbda441305e88c3b10171a219ddd7feb1520df4.png" src="../_images/3bcc2dcf792af3a459d9571adbbda441305e88c3b10171a219ddd7feb1520df4.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting residuals after log transformation</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">initech_fit_log</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">,</span> <span class="n">initech_fit_log</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Fitted vs Residuals&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Fitted&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Residuals&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">probplot</span><span class="p">(</span><span class="n">initech_fit_log</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">plt</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Normal Q-Q Plot&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/52d155701cd5799281aa0a3c984b31142c384a8711bbdc23fbcad85bc2f7bf7c.png" src="../_images/52d155701cd5799281aa0a3c984b31142c384a8711bbdc23fbcad85bc2f7bf7c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculating RMSE</span>
<span class="n">rmse_original</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">initech_fit</span><span class="o">.</span><span class="n">resid</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">rmse_log_transformed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">initech_fit_log</span><span class="o">.</span><span class="n">resid</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">rmse_fitted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">initech</span><span class="o">.</span><span class="n">salary</span> <span class="o">-</span> <span class="n">initech_fit</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RMSE Original:&quot;</span><span class="p">,</span> <span class="n">rmse_original</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RMSE Log Transformed:&quot;</span><span class="p">,</span> <span class="n">rmse_log_transformed</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RMSE Fitted:&quot;</span><span class="p">,</span> <span class="n">rmse_fitted</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE Original: 27080.161878492752
RMSE Log Transformed: 0.19349066503490941
RMSE Fitted: 27080.161878492752
</pre></div>
</div>
</div>
</div>
</section>
<section id="transformaciones-del-predictor">
<h1>Transformaciones del predictor<a class="headerlink" href="#transformaciones-del-predictor" title="Permalink to this heading">#</a></h1>
<section id="un-modelo-cuadratico">
<h2>Un modelo cuadrático<a class="headerlink" href="#un-modelo-cuadratico" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">314</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">sim_quad</span><span class="p">(</span><span class="n">sample_size</span><span class="o">=</span><span class="mi">500</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">y</span><span class="p">})</span>

<span class="n">quad_data</span> <span class="o">=</span> <span class="n">sim_quad</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Linear Fit</span>
<span class="n">lin_fit</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="s1">&#39;y ~ x&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">quad_data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lin_fit</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       0.925
Model:                            OLS   Adj. R-squared:                  0.925
Method:                 Least Squares   F-statistic:                     2453.
Date:                Mon, 09 Oct 2023   Prob (F-statistic):          1.64e-113
Time:                        09:49:55   Log-Likelihood:                -748.10
No. Observations:                 200   AIC:                             1500.
Df Residuals:                     198   BIC:                             1507.
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept    -16.6439      1.445    -11.515      0.000     -19.494     -13.794
x             24.6529      0.498     49.532      0.000      23.671      25.634
==============================================================================
Omnibus:                        4.673   Durbin-Watson:                   1.932
Prob(Omnibus):                  0.097   Jarque-Bera (JB):                4.660
Skew:                           0.338   Prob(JB):                       0.0973
Kurtosis:                       2.682   Cond. No.                         6.32
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot Simulated Quadratic Data with Linear Fit</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">quad_data</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">quad_data</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">quad_data</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">lin_fit</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Simulated Quadratic Data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/fd60011d646f8c578ab16592b539530e0b2a885198b1ec26c293270a0dd2d05b.png" src="../_images/fd60011d646f8c578ab16592b539530e0b2a885198b1ec26c293270a0dd2d05b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot Residuals and QQ Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lin_fit</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">,</span> <span class="n">lin_fit</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Fitted vs Residuals&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Fitted&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Residuals&quot;</span><span class="p">)</span>
<span class="n">probplot</span><span class="p">(</span><span class="n">lin_fit</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/be8e3046fea5b6798ff960976775e79b1e9c18b94bfd0bc96f636b87f6aa01d4.png" src="../_images/be8e3046fea5b6798ff960976775e79b1e9c18b94bfd0bc96f636b87f6aa01d4.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Quadratic Fit</span>
<span class="n">quad_fit</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="s1">&#39;y ~ x + I(x**2)&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">quad_data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">quad_fit</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       0.978
Model:                            OLS   Adj. R-squared:                  0.978
Method:                 Least Squares   F-statistic:                     4481.
Date:                Mon, 09 Oct 2023   Prob (F-statistic):          5.83e-165
Time:                        09:49:55   Log-Likelihood:                -623.64
No. Observations:                 200   AIC:                             1253.
Df Residuals:                     197   BIC:                             1263.
Df Model:                           2                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept      2.0693      1.151      1.798      0.074      -0.200       4.338
x              1.3495      1.090      1.239      0.217      -0.799       3.498
I(x ** 2)      4.7253      0.214     22.066      0.000       4.303       5.148
==============================================================================
Omnibus:                        0.498   Durbin-Watson:                   1.933
Prob(Omnibus):                  0.779   Jarque-Bera (JB):                0.231
Skew:                           0.017   Prob(JB):                        0.891
Kurtosis:                       3.163   Cond. No.                         45.8
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot Simulated Quadratic Data with Quadratic Fit</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">quad_data</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">quad_data</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">x_sorted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">quad_data</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_sorted</span><span class="p">,</span> <span class="n">quad_fit</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">quad_fit</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_sorted</span> <span class="o">+</span> <span class="n">quad_fit</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_sorted</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Simulated Quadratic Data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/e5c78f8403c16ba4e0b5898732b80fc72a9dcb80442eb3cfcde9415adb96289f.png" src="../_images/e5c78f8403c16ba4e0b5898732b80fc72a9dcb80442eb3cfcde9415adb96289f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot Residuals and QQ Plot for Quadratic Fit</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">quad_fit</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">,</span> <span class="n">quad_fit</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Fitted vs Residuals&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Fitted&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Residuals&quot;</span><span class="p">)</span>
<span class="n">probplot</span><span class="p">(</span><span class="n">quad_fit</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/4be236b44be3edbf1d95431f966da6c89bc5f0c7cb3f7e0812b584eb1b91d6a4.png" src="../_images/4be236b44be3edbf1d95431f966da6c89bc5f0c7cb3f7e0812b584eb1b91d6a4.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Week_8"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="8-1-diagnostics.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Lectura 8-1: Diagnóstico de modelos</p>
      </div>
    </a>
    <a class="right-next"
       href="8-3-collinearity.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Lectura 8-3: Colinealidad</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Lectura 8-2: Transformaciones</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#transformacion-de-la-respuesta">Transformación de la respuesta</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#transformaciones-estabilizadoras-de-la-varianza">Transformaciones estabilizadoras de la varianza</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#transformaciones-de-box-cox">Transformaciones de Box-Cox</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#transformacion-del-predictor">Transformación del predictor</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#polinomios">Polinomios</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#transformaciones-de-respuesta">Transformaciones de respuesta</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#transformaciones-del-predictor">Transformaciones del predictor</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#un-modelo-cuadratico">Un modelo cuadrático</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Alejandra Tabares
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>